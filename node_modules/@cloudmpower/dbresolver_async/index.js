(function () {

    module.exports = async (mongoDB, ctx, next) => {
        let mongo = (typeof mongoDB != "function") ? {} : mongoDB;
        let mongoose = (typeof mongo["mongoose"] != "object") ? {} : mongo["mongoose"];

        let connection = mongoose.connection;
        let mongoConn = (typeof connection != "object") ? {} : connection;
        let state = (typeof mongoConn._readyState != "number") ? 0 : mongoConn._readyState;

        if(state != 1 && ctx.method == "POST"){
            let response = {"status": 503, "responseData": {"errorCode": "ERR503", "message": "Database service not available!" }};
            ctx.status = response.status;
            ctx.body = response;
        }else{
            await next();
        }
    };
})();